@{
    int getLang = Shared.GetLang();
    using (MvcXmlEntities ConnXml = new MvcXmlEntities())
    {
        int getFormID = 2;
        Setting Setting = ConnXml.Setting.FirstOrDefault();
        int centerOfficeID = 0;
        if (PageData[0] != null)
        {
            centerOfficeID = Convert.ToInt32(PageData[0]);
        }
        Branch getMainBranc = null;
        IQueryable<Branch> IqBranch = ConnXml.Branch.Where(x => x.Status);
        int TotalBranch = ConnXml.Branch.Where(x => x.Status).Count();
        if (centerOfficeID > 0)
        {
            getMainBranc = IqBranch.FirstOrDefault(x => x.BranchID == centerOfficeID);
        }
        if (IsPost)
        {
            var txtNameSurname = Request.Form["txtNameSurname"];
            var txtPhone = Request.Form["txtPhone"];
            var txtEmail = Request.Form["txtEmail"];
            var txtMessage = Request.Form["txtMessage"];
            var chckKvkk = Request.Form["chckKvkk"];
            var chckElectronic = Request.Form["chckElectronic"];
            var GoogleCaptchaToken = Request.Form["GoogleCaptchaToken"];

            if (Shared.EmailIsValid(txtEmail))
            {
                ContactForm passwordRequestForm = new ContactForm()
                {
                    NameSurname = txtNameSurname,
                    Email = txtEmail,
                    Phone = txtPhone,
                    IpAddress = Shared.GetIpAddress(),
                    AcceptElectronicMessage = chckElectronic == "ok" ? true : false,
                    KVKK = chckKvkk == "ok" ? true : false,
                    LangID = Shared.GetLang(),
                    AddDate = DateTime.Now
                };
                if (txtPhone != "testing@example.com" && txtNameSurname != "ghovjnjv")
                {
                    ConnXml.ContactForm.Add(passwordRequestForm);
                    int ConnStatus = ConnXml.SaveChanges();
                    if (ConnStatus > 0)
                    {
                        #region MailNames
                        string[] MailNames = {
                         "Ad Soyad",
                         "Telefon",
                         "E-Posta adresi",
                         "Mesaj",
                         "KVKK",
                         "Elektronik İleti Gönderimini ",
                         "Gönderim Tarihi"
                     };
                        #endregion
                        #region MailValues
                        string[] MailValues = {
                             txtNameSurname,
                             txtPhone,
                             txtEmail,
                             txtMessage,
                             chckKvkk,
                             chckElectronic,
                             DateTime.Now.ToString()
                         };
                        #endregion
                        if (ConnXml.FormMailRelation.Any(x => x.FormID == getFormID))
                        {
                            FormMailRelation FormMailRelation = ConnXml.FormMailRelation.FirstOrDefault(x => x.FormID == getFormID);
                            foreach (MailAccount itemAccount in ConnXml.MailAccount.Where(x => x.MailGroupID == FormMailRelation.MailGroupID))
                            {
                                var content = Setting.Pagetitle + " web sitesinden iletişim formu gönderildi.<br /><br />" + Shared.ToFormBody(MailNames, MailValues);
                                Shared.SendMail(itemAccount.Address, "Bize Ulaşın - PhillipCapital",content);

                                //WebMail.Password = "!!Phc44**";
                                //WebMail.Send(to: itemAccount.Address, from:"bilgi@phillipcapital.com.tr", subject: "İletişim Formu", isBodyHtml: true, body: Setting.Pagetitle + " web sitesinden iletişim formu gönderildi.<br /><br />" + Shared.ToFormBody(MailNames, MailValues));
                            }
                        }
                    }
                    @Html.Raw(Shared.GetTranslation(182))
                }
            }
            else
            { @Html.Raw("Error") }
    }
    else
    {
        <div class="iletisim-ve-ofislerimiz-bizeulasin">
            <div class="bize-ulasin-inner">
                <p>
                    @Shared.GetTranslation(14)
                </p>
                <form method="post">
                    @HelperClientControl.inputText("txtNameSurname", Shared.GetTranslation(17), false, true, "", "input-giris")
                    @HelperClientControl.inputText("txtPhone", Shared.GetTranslation(16), false, true, "", "input-giris")
                    @HelperClientControl.inputText("txtEmail", Shared.GetTranslation(8), false, true, "Email", "input-giris")
                    @HelperClientControl.inputText("txtMessage", Shared.GetTranslation(24), true, true, "", "input-giris")
                    @HelperClientControl.CheckBox("chckKvkk", "<strong>KVKK </strong>Şartlarını Kabul Ediyorum.", true, GetSeoUrl.getPagesUrl(49))
                    @HelperClientControl.CheckBox("chckElectronic", "Elektronik İleti Gönderimini Kabul Ediyorum.", true, GetSeoUrl.getPagesUrl(50))
                    <input id="GoogleCaptchaToken" name="GoogleCaptchaToken" type="hidden" />
                    <div class="form-sifre-talep-alt">
                        <div class="google-recaptcha">
                            <input type="submit" id="submit" value="@Shared.GetTranslation(22)" />
                        </div>
                    </div>
                </form>
            </div>
            @{
                if (getMainBranc != null)
                {
                    <div class="merkez-ofis">
                        <div class="map" id="map">
                            <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3007.5246092416455!2d29.00639191570656!3d41.07938302299456!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x14cab6e3c1603173%3A0x8d6de709c32f09a9!2sPhillip%20CapitalMenkul%20De%C4%9Ferler%20A.%C5%9E.!5e0!3m2!1str!2str!4v1677739559189!5m2!1str!2str" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                        </div>
                        <div class="ofis">
                            <h3> @getMainBranc.Title </h3>
                            <p> @getMainBranc.Address </p>
                            <p> @Shared.GetTranslation(101) </p>
                            <p> @Shared.GetTranslation(102) </p>
                        </div>
                    </div>
                    <div class="diger-ofislerimiz">
                        <img src="/Content/images/location-pin-2.svg" />
                        <h2>  @Shared.GetTranslation(20)</h2>
                        <div class="ofis-ara-search-bar">
                            <img src="/Content/images/beyaz-magnifiying-glass.svg" />
                            <form method="GET" action="/ofislerimiz" id="officeForm">
                                <input type="text" name="search" placeholder="@Shared.GetTranslation(23)" />
                            </form>
                        </div>
                        <a href="javascript:;" onclick="$('form#officeForm').submit()">
                            @TotalBranch @Shared.GetTranslation(21)
                        </a>
                    </div>
                }
            }
        </div>
    }
}
}